var $e=Object.defineProperty;var je=(r,t,e)=>t in r?$e(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var R=(r,t,e)=>(je(r,typeof t!="symbol"?t+"":t,e),e);import{polygon as Ve,multiPolygon as Ke}from"./index-ByNvCHXr.js";import{g as Xe}from"./index-Dds9rs_F.js";var He=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,Te=Math.ceil,H=Math.floor,U="[BigNumber Error] ",Me=U+"Number primitive has more than 15 significant digits: ",Z=1e14,N=14,Re=9007199254740991,Oe=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],ne=1e7,q=1e9;function qe(r){var t,e,o,n=S.prototype={constructor:S,toString:null,valueOf:null},g=new S(1),d=20,x=4,v=-7,w=21,L=-1e7,T=1e7,b=!1,C=1,$=0,j={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"Â ",suffix:""},D="0123456789abcdefghijklmnopqrstuvwxyz",de=!0;function S(i,s){var l,p,f,c,m,u,h,y,a=this;if(!(a instanceof S))return new S(i,s);if(s==null){if(i&&i._isBigNumber===!0){a.s=i.s,!i.c||i.e>T?a.c=a.e=null:i.e<L?a.c=[a.e=0]:(a.e=i.e,a.c=i.c.slice());return}if((u=typeof i=="number")&&i*0==0){if(a.s=1/i<0?(i=-i,-1):1,i===~~i){for(c=0,m=i;m>=10;m/=10,c++);c>T?a.c=a.e=null:(a.e=c,a.c=[i]);return}y=String(i)}else{if(!He.test(y=String(i)))return o(a,y,u);a.s=y.charCodeAt(0)==45?(y=y.slice(1),-1):1}(c=y.indexOf("."))>-1&&(y=y.replace(".","")),(m=y.search(/e/i))>0?(c<0&&(c=m),c+=+y.slice(m+1),y=y.substring(0,m)):c<0&&(c=y.length)}else{if(P(s,2,D.length,"Base"),s==10&&de)return a=new S(i),V(a,d+a.e+1,x);if(y=String(i),u=typeof i=="number"){if(i*0!=0)return o(a,y,u,s);if(a.s=1/i<0?(y=y.slice(1),-1):1,S.DEBUG&&y.replace(/^0\.0*|\./,"").length>15)throw Error(Me+i)}else a.s=y.charCodeAt(0)===45?(y=y.slice(1),-1):1;for(l=D.slice(0,s),c=m=0,h=y.length;m<h;m++)if(l.indexOf(p=y.charAt(m))<0){if(p=="."){if(m>c){c=h;continue}}else if(!f&&(y==y.toUpperCase()&&(y=y.toLowerCase())||y==y.toLowerCase()&&(y=y.toUpperCase()))){f=!0,m=-1,c=0;continue}return o(a,String(i),u,s)}u=!1,y=e(y,s,10,a.s),(c=y.indexOf("."))>-1?y=y.replace(".",""):c=y.length}for(m=0;y.charCodeAt(m)===48;m++);for(h=y.length;y.charCodeAt(--h)===48;);if(y=y.slice(m,++h)){if(h-=m,u&&S.DEBUG&&h>15&&(i>Re||i!==H(i)))throw Error(Me+a.s*i);if((c=c-m-1)>T)a.c=a.e=null;else if(c<L)a.c=[a.e=0];else{if(a.e=c,a.c=[],m=(c+1)%N,c<0&&(m+=N),m<h){for(m&&a.c.push(+y.slice(0,m)),h-=N;m<h;)a.c.push(+y.slice(m,m+=N));m=N-(y=y.slice(m)).length}else m-=h;for(;m--;y+="0");a.c.push(+y)}}else a.c=[a.e=0]}S.clone=qe,S.ROUND_UP=0,S.ROUND_DOWN=1,S.ROUND_CEIL=2,S.ROUND_FLOOR=3,S.ROUND_HALF_UP=4,S.ROUND_HALF_DOWN=5,S.ROUND_HALF_EVEN=6,S.ROUND_HALF_CEIL=7,S.ROUND_HALF_FLOOR=8,S.EUCLID=9,S.config=S.set=function(i){var s,l;if(i!=null)if(typeof i=="object"){if(i.hasOwnProperty(s="DECIMAL_PLACES")&&(l=i[s],P(l,0,q,s),d=l),i.hasOwnProperty(s="ROUNDING_MODE")&&(l=i[s],P(l,0,8,s),x=l),i.hasOwnProperty(s="EXPONENTIAL_AT")&&(l=i[s],l&&l.pop?(P(l[0],-q,0,s),P(l[1],0,q,s),v=l[0],w=l[1]):(P(l,-q,q,s),v=-(w=l<0?-l:l))),i.hasOwnProperty(s="RANGE"))if(l=i[s],l&&l.pop)P(l[0],-q,-1,s),P(l[1],1,q,s),L=l[0],T=l[1];else if(P(l,-q,q,s),l)L=-(T=l<0?-l:l);else throw Error(U+s+" cannot be zero: "+l);if(i.hasOwnProperty(s="CRYPTO"))if(l=i[s],l===!!l)if(l)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))b=l;else throw b=!l,Error(U+"crypto unavailable");else b=l;else throw Error(U+s+" not true or false: "+l);if(i.hasOwnProperty(s="MODULO_MODE")&&(l=i[s],P(l,0,9,s),C=l),i.hasOwnProperty(s="POW_PRECISION")&&(l=i[s],P(l,0,q,s),$=l),i.hasOwnProperty(s="FORMAT"))if(l=i[s],typeof l=="object")j=l;else throw Error(U+s+" not an object: "+l);if(i.hasOwnProperty(s="ALPHABET"))if(l=i[s],typeof l=="string"&&!/^.?$|[+\-.\s]|(.).*\1/.test(l))de=l.slice(0,10)=="0123456789",D=l;else throw Error(U+s+" invalid: "+l)}else throw Error(U+"Object expected: "+i);return{DECIMAL_PLACES:d,ROUNDING_MODE:x,EXPONENTIAL_AT:[v,w],RANGE:[L,T],CRYPTO:b,MODULO_MODE:C,POW_PRECISION:$,FORMAT:j,ALPHABET:D}},S.isBigNumber=function(i){if(!i||i._isBigNumber!==!0)return!1;if(!S.DEBUG)return!0;var s,l,p=i.c,f=i.e,c=i.s;e:if({}.toString.call(p)=="[object Array]"){if((c===1||c===-1)&&f>=-q&&f<=q&&f===H(f)){if(p[0]===0){if(f===0&&p.length===1)return!0;break e}if(s=(f+1)%N,s<1&&(s+=N),String(p[0]).length==s){for(s=0;s<p.length;s++)if(l=p[s],l<0||l>=Z||l!==H(l))break e;if(l!==0)return!0}}}else if(p===null&&f===null&&(c===null||c===1||c===-1))return!0;throw Error(U+"Invalid BigNumber: "+i)},S.maximum=S.max=function(){return Ae(arguments,-1)},S.minimum=S.min=function(){return Ae(arguments,1)},S.random=function(){var i=9007199254740992,s=Math.random()*i&2097151?function(){return H(Math.random()*i)}:function(){return(Math.random()*1073741824|0)*8388608+(Math.random()*8388608|0)};return function(l){var p,f,c,m,u,h=0,y=[],a=new S(g);if(l==null?l=d:P(l,0,q),m=Te(l/N),b)if(crypto.getRandomValues){for(p=crypto.getRandomValues(new Uint32Array(m*=2));h<m;)u=p[h]*131072+(p[h+1]>>>11),u>=9e15?(f=crypto.getRandomValues(new Uint32Array(2)),p[h]=f[0],p[h+1]=f[1]):(y.push(u%1e14),h+=2);h=m/2}else if(crypto.randomBytes){for(p=crypto.randomBytes(m*=7);h<m;)u=(p[h]&31)*281474976710656+p[h+1]*1099511627776+p[h+2]*4294967296+p[h+3]*16777216+(p[h+4]<<16)+(p[h+5]<<8)+p[h+6],u>=9e15?crypto.randomBytes(7).copy(p,h):(y.push(u%1e14),h+=7);h=m/7}else throw b=!1,Error(U+"crypto unavailable");if(!b)for(;h<m;)u=s(),u<9e15&&(y[h++]=u%1e14);for(m=y[--h],l%=N,m&&l&&(u=Oe[N-l],y[h]=H(m/u)*u);y[h]===0;y.pop(),h--);if(h<0)y=[c=0];else{for(c=-1;y[0]===0;y.splice(0,1),c-=N);for(h=1,u=y[0];u>=10;u/=10,h++);h<N&&(c-=N-h)}return a.e=c,a.c=y,a}}(),S.sum=function(){for(var i=1,s=arguments,l=new S(s[0]);i<s.length;)l=l.plus(s[i++]);return l},e=function(){var i="0123456789";function s(l,p,f,c){for(var m,u=[0],h,y=0,a=l.length;y<a;){for(h=u.length;h--;u[h]*=p);for(u[0]+=c.indexOf(l.charAt(y++)),m=0;m<u.length;m++)u[m]>f-1&&(u[m+1]==null&&(u[m+1]=0),u[m+1]+=u[m]/f|0,u[m]%=f)}return u.reverse()}return function(l,p,f,c,m){var u,h,y,a,E,O,I,A,B=l.indexOf("."),G=d,_=x;for(B>=0&&(a=$,$=0,l=l.replace(".",""),A=new S(p),O=A.pow(l.length-B),$=a,A.c=s(te(X(O.c),O.e,"0"),10,f,i),A.e=A.c.length),I=s(l,p,f,m?(u=D,i):(u=i,D)),y=a=I.length;I[--a]==0;I.pop());if(!I[0])return u.charAt(0);if(B<0?--y:(O.c=I,O.e=y,O.s=c,O=t(O,A,G,_,f),I=O.c,E=O.r,y=O.e),h=y+G+1,B=I[h],a=f/2,E=E||h<0||I[h+1]!=null,E=_<4?(B!=null||E)&&(_==0||_==(O.s<0?3:2)):B>a||B==a&&(_==4||E||_==6&&I[h-1]&1||_==(O.s<0?8:7)),h<1||!I[0])l=E?te(u.charAt(1),-G,u.charAt(0)):u.charAt(0);else{if(I.length=h,E)for(--f;++I[--h]>f;)I[h]=0,h||(++y,I=[1].concat(I));for(a=I.length;!I[--a];);for(B=0,l="";B<=a;l+=u.charAt(I[B++]));l=te(l,y,u.charAt(0))}return l}}(),t=function(){function i(p,f,c){var m,u,h,y,a=0,E=p.length,O=f%ne,I=f/ne|0;for(p=p.slice();E--;)h=p[E]%ne,y=p[E]/ne|0,m=I*h+y*O,u=O*h+m%ne*ne+a,a=(u/c|0)+(m/ne|0)+I*y,p[E]=u%c;return a&&(p=[a].concat(p)),p}function s(p,f,c,m){var u,h;if(c!=m)h=c>m?1:-1;else for(u=h=0;u<c;u++)if(p[u]!=f[u]){h=p[u]>f[u]?1:-1;break}return h}function l(p,f,c,m){for(var u=0;c--;)p[c]-=u,u=p[c]<f[c]?1:0,p[c]=u*m+p[c]-f[c];for(;!p[0]&&p.length>1;p.splice(0,1));}return function(p,f,c,m,u){var h,y,a,E,O,I,A,B,G,_,M,F,he,ve,Se,W,oe,K=p.s==f.s?1:-1,z=p.c,k=f.c;if(!z||!z[0]||!k||!k[0])return new S(!p.s||!f.s||(z?k&&z[0]==k[0]:!k)?NaN:z&&z[0]==0||!k?K*0:K/0);for(B=new S(K),G=B.c=[],y=p.e-f.e,K=c+y+1,u||(u=Z,y=Y(p.e/N)-Y(f.e/N),K=K/N|0),a=0;k[a]==(z[a]||0);a++);if(k[a]>(z[a]||0)&&y--,K<0)G.push(1),E=!0;else{for(ve=z.length,W=k.length,a=0,K+=2,O=H(u/(k[0]+1)),O>1&&(k=i(k,O,u),z=i(z,O,u),W=k.length,ve=z.length),he=W,_=z.slice(0,W),M=_.length;M<W;_[M++]=0);oe=k.slice(),oe=[0].concat(oe),Se=k[0],k[1]>=u/2&&Se++;do{if(O=0,h=s(k,_,W,M),h<0){if(F=_[0],W!=M&&(F=F*u+(_[1]||0)),O=H(F/Se),O>1)for(O>=u&&(O=u-1),I=i(k,O,u),A=I.length,M=_.length;s(I,_,A,M)==1;)O--,l(I,W<A?oe:k,A,u),A=I.length,h=1;else O==0&&(h=O=1),I=k.slice(),A=I.length;if(A<M&&(I=[0].concat(I)),l(_,I,M,u),M=_.length,h==-1)for(;s(k,_,W,M)<1;)O++,l(_,W<M?oe:k,M,u),M=_.length}else h===0&&(O++,_=[0]);G[a++]=O,_[0]?_[M++]=z[he]||0:(_=[z[he]],M=1)}while((he++<ve||_[0]!=null)&&K--);E=_[0]!=null,G[0]||G.splice(0,1)}if(u==Z){for(a=1,K=G[0];K>=10;K/=10,a++);V(B,c+(B.e=a+y*N-1)+1,m,E)}else B.e=y,B.r=+E;return B}}();function we(i,s,l,p){var f,c,m,u,h;if(l==null?l=x:P(l,0,8),!i.c)return i.toString();if(f=i.c[0],m=i.e,s==null)h=X(i.c),h=p==1||p==2&&(m<=v||m>=w)?ae(h,m):te(h,m,"0");else if(i=V(new S(i),s,l),c=i.e,h=X(i.c),u=h.length,p==1||p==2&&(s<=c||c<=v)){for(;u<s;h+="0",u++);h=ae(h,c)}else if(s-=m+(p===2&&c>m),h=te(h,c,"0"),c+1>u){if(--s>0)for(h+=".";s--;h+="0");}else if(s+=c-u,s>0)for(c+1==u&&(h+=".");s--;h+="0");return i.s<0&&f?"-"+h:h}function Ae(i,s){for(var l,p,f=1,c=new S(i[0]);f<i.length;f++)p=new S(i[f]),(!p.s||(l=se(c,p))===s||l===0&&c.s===s)&&(c=p);return c}function Ee(i,s,l){for(var p=1,f=s.length;!s[--f];s.pop());for(f=s[0];f>=10;f/=10,p++);return(l=p+l*N-1)>T?i.c=i.e=null:l<L?i.c=[i.e=0]:(i.e=l,i.c=s),i}o=function(){var i=/^(-?)0([xbo])(?=\w[\w.]*$)/i,s=/^([^.]+)\.$/,l=/^\.([^.]+)$/,p=/^-?(Infinity|NaN)$/,f=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(c,m,u,h){var y,a=u?m:m.replace(f,"");if(p.test(a))c.s=isNaN(a)?null:a<0?-1:1;else{if(!u&&(a=a.replace(i,function(E,O,I){return y=(I=I.toLowerCase())=="x"?16:I=="b"?2:8,!h||h==y?O:E}),h&&(y=h,a=a.replace(s,"$1").replace(l,"0.$1")),m!=a))return new S(a,y);if(S.DEBUG)throw Error(U+"Not a"+(h?" base "+h:"")+" number: "+m);c.s=null}c.c=c.e=null}}();function V(i,s,l,p){var f,c,m,u,h,y,a,E=i.c,O=Oe;if(E){e:{for(f=1,u=E[0];u>=10;u/=10,f++);if(c=s-f,c<0)c+=N,m=s,h=E[y=0],a=H(h/O[f-m-1]%10);else if(y=Te((c+1)/N),y>=E.length)if(p){for(;E.length<=y;E.push(0));h=a=0,f=1,c%=N,m=c-N+1}else break e;else{for(h=u=E[y],f=1;u>=10;u/=10,f++);c%=N,m=c-N+f,a=m<0?0:H(h/O[f-m-1]%10)}if(p=p||s<0||E[y+1]!=null||(m<0?h:h%O[f-m-1]),p=l<4?(a||p)&&(l==0||l==(i.s<0?3:2)):a>5||a==5&&(l==4||p||l==6&&(c>0?m>0?h/O[f-m]:0:E[y-1])%10&1||l==(i.s<0?8:7)),s<1||!E[0])return E.length=0,p?(s-=i.e+1,E[0]=O[(N-s%N)%N],i.e=-s||0):E[0]=i.e=0,i;if(c==0?(E.length=y,u=1,y--):(E.length=y+1,u=O[N-c],E[y]=m>0?H(h/O[f-m]%O[m])*u:0),p)for(;;)if(y==0){for(c=1,m=E[0];m>=10;m/=10,c++);for(m=E[0]+=u,u=1;m>=10;m/=10,u++);c!=u&&(i.e++,E[0]==Z&&(E[0]=1));break}else{if(E[y]+=u,E[y]!=Z)break;E[y--]=0,u=1}for(c=E.length;E[--c]===0;E.pop());}i.e>T?i.c=i.e=null:i.e<L&&(i.c=[i.e=0])}return i}function ee(i){var s,l=i.e;return l===null?i.toString():(s=X(i.c),s=l<=v||l>=w?ae(s,l):te(s,l,"0"),i.s<0?"-"+s:s)}return n.absoluteValue=n.abs=function(){var i=new S(this);return i.s<0&&(i.s=1),i},n.comparedTo=function(i,s){return se(this,new S(i,s))},n.decimalPlaces=n.dp=function(i,s){var l,p,f,c=this;if(i!=null)return P(i,0,q),s==null?s=x:P(s,0,8),V(new S(c),i+c.e+1,s);if(!(l=c.c))return null;if(p=((f=l.length-1)-Y(this.e/N))*N,f=l[f])for(;f%10==0;f/=10,p--);return p<0&&(p=0),p},n.dividedBy=n.div=function(i,s){return t(this,new S(i,s),d,x)},n.dividedToIntegerBy=n.idiv=function(i,s){return t(this,new S(i,s),0,1)},n.exponentiatedBy=n.pow=function(i,s){var l,p,f,c,m,u,h,y,a,E=this;if(i=new S(i),i.c&&!i.isInteger())throw Error(U+"Exponent not an integer: "+ee(i));if(s!=null&&(s=new S(s)),u=i.e>14,!E.c||!E.c[0]||E.c[0]==1&&!E.e&&E.c.length==1||!i.c||!i.c[0])return a=new S(Math.pow(+ee(E),u?i.s*(2-ce(i)):+ee(i))),s?a.mod(s):a;if(h=i.s<0,s){if(s.c?!s.c[0]:!s.s)return new S(NaN);p=!h&&E.isInteger()&&s.isInteger(),p&&(E=E.mod(s))}else{if(i.e>9&&(E.e>0||E.e<-1||(E.e==0?E.c[0]>1||u&&E.c[1]>=24e7:E.c[0]<8e13||u&&E.c[0]<=9999975e7)))return c=E.s<0&&ce(i)?-0:0,E.e>-1&&(c=1/c),new S(h?1/c:c);$&&(c=Te($/N+2))}for(u?(l=new S(.5),h&&(i.s=1),y=ce(i)):(f=Math.abs(+ee(i)),y=f%2),a=new S(g);;){if(y){if(a=a.times(E),!a.c)break;c?a.c.length>c&&(a.c.length=c):p&&(a=a.mod(s))}if(f){if(f=H(f/2),f===0)break;y=f%2}else if(i=i.times(l),V(i,i.e+1,1),i.e>14)y=ce(i);else{if(f=+ee(i),f===0)break;y=f%2}E=E.times(E),c?E.c&&E.c.length>c&&(E.c.length=c):p&&(E=E.mod(s))}return p?a:(h&&(a=g.div(a)),s?a.mod(s):c?V(a,$,x,m):a)},n.integerValue=function(i){var s=new S(this);return i==null?i=x:P(i,0,8),V(s,s.e+1,i)},n.isEqualTo=n.eq=function(i,s){return se(this,new S(i,s))===0},n.isFinite=function(){return!!this.c},n.isGreaterThan=n.gt=function(i,s){return se(this,new S(i,s))>0},n.isGreaterThanOrEqualTo=n.gte=function(i,s){return(s=se(this,new S(i,s)))===1||s===0},n.isInteger=function(){return!!this.c&&Y(this.e/N)>this.c.length-2},n.isLessThan=n.lt=function(i,s){return se(this,new S(i,s))<0},n.isLessThanOrEqualTo=n.lte=function(i,s){return(s=se(this,new S(i,s)))===-1||s===0},n.isNaN=function(){return!this.s},n.isNegative=function(){return this.s<0},n.isPositive=function(){return this.s>0},n.isZero=function(){return!!this.c&&this.c[0]==0},n.minus=function(i,s){var l,p,f,c,m=this,u=m.s;if(i=new S(i,s),s=i.s,!u||!s)return new S(NaN);if(u!=s)return i.s=-s,m.plus(i);var h=m.e/N,y=i.e/N,a=m.c,E=i.c;if(!h||!y){if(!a||!E)return a?(i.s=-s,i):new S(E?m:NaN);if(!a[0]||!E[0])return E[0]?(i.s=-s,i):new S(a[0]?m:x==3?-0:0)}if(h=Y(h),y=Y(y),a=a.slice(),u=h-y){for((c=u<0)?(u=-u,f=a):(y=h,f=E),f.reverse(),s=u;s--;f.push(0));f.reverse()}else for(p=(c=(u=a.length)<(s=E.length))?u:s,u=s=0;s<p;s++)if(a[s]!=E[s]){c=a[s]<E[s];break}if(c&&(f=a,a=E,E=f,i.s=-i.s),s=(p=E.length)-(l=a.length),s>0)for(;s--;a[l++]=0);for(s=Z-1;p>u;){if(a[--p]<E[p]){for(l=p;l&&!a[--l];a[l]=s);--a[l],a[p]+=Z}a[p]-=E[p]}for(;a[0]==0;a.splice(0,1),--y);return a[0]?Ee(i,a,y):(i.s=x==3?-1:1,i.c=[i.e=0],i)},n.modulo=n.mod=function(i,s){var l,p,f=this;return i=new S(i,s),!f.c||!i.s||i.c&&!i.c[0]?new S(NaN):!i.c||f.c&&!f.c[0]?new S(f):(C==9?(p=i.s,i.s=1,l=t(f,i,0,3),i.s=p,l.s*=p):l=t(f,i,0,C),i=f.minus(l.times(i)),!i.c[0]&&C==1&&(i.s=f.s),i)},n.multipliedBy=n.times=function(i,s){var l,p,f,c,m,u,h,y,a,E,O,I,A,B,G,_=this,M=_.c,F=(i=new S(i,s)).c;if(!M||!F||!M[0]||!F[0])return!_.s||!i.s||M&&!M[0]&&!F||F&&!F[0]&&!M?i.c=i.e=i.s=null:(i.s*=_.s,!M||!F?i.c=i.e=null:(i.c=[0],i.e=0)),i;for(p=Y(_.e/N)+Y(i.e/N),i.s*=_.s,h=M.length,E=F.length,h<E&&(A=M,M=F,F=A,f=h,h=E,E=f),f=h+E,A=[];f--;A.push(0));for(B=Z,G=ne,f=E;--f>=0;){for(l=0,O=F[f]%G,I=F[f]/G|0,m=h,c=f+m;c>f;)y=M[--m]%G,a=M[m]/G|0,u=I*y+a*O,y=O*y+u%G*G+A[c]+l,l=(y/B|0)+(u/G|0)+I*a,A[c--]=y%B;A[c]=l}return l?++p:A.splice(0,1),Ee(i,A,p)},n.negated=function(){var i=new S(this);return i.s=-i.s||null,i},n.plus=function(i,s){var l,p=this,f=p.s;if(i=new S(i,s),s=i.s,!f||!s)return new S(NaN);if(f!=s)return i.s=-s,p.minus(i);var c=p.e/N,m=i.e/N,u=p.c,h=i.c;if(!c||!m){if(!u||!h)return new S(f/0);if(!u[0]||!h[0])return h[0]?i:new S(u[0]?p:f*0)}if(c=Y(c),m=Y(m),u=u.slice(),f=c-m){for(f>0?(m=c,l=h):(f=-f,l=u),l.reverse();f--;l.push(0));l.reverse()}for(f=u.length,s=h.length,f-s<0&&(l=h,h=u,u=l,s=f),f=0;s;)f=(u[--s]=u[s]+h[s]+f)/Z|0,u[s]=Z===u[s]?0:u[s]%Z;return f&&(u=[f].concat(u),++m),Ee(i,u,m)},n.precision=n.sd=function(i,s){var l,p,f,c=this;if(i!=null&&i!==!!i)return P(i,1,q),s==null?s=x:P(s,0,8),V(new S(c),i,s);if(!(l=c.c))return null;if(f=l.length-1,p=f*N+1,f=l[f]){for(;f%10==0;f/=10,p--);for(f=l[0];f>=10;f/=10,p++);}return i&&c.e+1>p&&(p=c.e+1),p},n.shiftedBy=function(i){return P(i,-Re,Re),this.times("1e"+i)},n.squareRoot=n.sqrt=function(){var i,s,l,p,f,c=this,m=c.c,u=c.s,h=c.e,y=d+4,a=new S("0.5");if(u!==1||!m||!m[0])return new S(!u||u<0&&(!m||m[0])?NaN:m?c:1/0);if(u=Math.sqrt(+ee(c)),u==0||u==1/0?(s=X(m),(s.length+h)%2==0&&(s+="0"),u=Math.sqrt(+s),h=Y((h+1)/2)-(h<0||h%2),u==1/0?s="5e"+h:(s=u.toExponential(),s=s.slice(0,s.indexOf("e")+1)+h),l=new S(s)):l=new S(u+""),l.c[0]){for(h=l.e,u=h+y,u<3&&(u=0);;)if(f=l,l=a.times(f.plus(t(c,f,y,1))),X(f.c).slice(0,u)===(s=X(l.c)).slice(0,u))if(l.e<h&&--u,s=s.slice(u-3,u+1),s=="9999"||!p&&s=="4999"){if(!p&&(V(f,f.e+d+2,0),f.times(f).eq(c))){l=f;break}y+=4,u+=4,p=1}else{(!+s||!+s.slice(1)&&s.charAt(0)=="5")&&(V(l,l.e+d+2,1),i=!l.times(l).eq(c));break}}return V(l,l.e+d+1,x,i)},n.toExponential=function(i,s){return i!=null&&(P(i,0,q),i++),we(this,i,s,1)},n.toFixed=function(i,s){return i!=null&&(P(i,0,q),i=i+this.e+1),we(this,i,s)},n.toFormat=function(i,s,l){var p,f=this;if(l==null)i!=null&&s&&typeof s=="object"?(l=s,s=null):i&&typeof i=="object"?(l=i,i=s=null):l=j;else if(typeof l!="object")throw Error(U+"Argument not an object: "+l);if(p=f.toFixed(i,s),f.c){var c,m=p.split("."),u=+l.groupSize,h=+l.secondaryGroupSize,y=l.groupSeparator||"",a=m[0],E=m[1],O=f.s<0,I=O?a.slice(1):a,A=I.length;if(h&&(c=u,u=h,h=c,A-=c),u>0&&A>0){for(c=A%u||u,a=I.substr(0,c);c<A;c+=u)a+=y+I.substr(c,u);h>0&&(a+=y+I.slice(c)),O&&(a="-"+a)}p=E?a+(l.decimalSeparator||"")+((h=+l.fractionGroupSize)?E.replace(new RegExp("\\d{"+h+"}\\B","g"),"$&"+(l.fractionGroupSeparator||"")):E):a}return(l.prefix||"")+p+(l.suffix||"")},n.toFraction=function(i){var s,l,p,f,c,m,u,h,y,a,E,O,I=this,A=I.c;if(i!=null&&(u=new S(i),!u.isInteger()&&(u.c||u.s!==1)||u.lt(g)))throw Error(U+"Argument "+(u.isInteger()?"out of range: ":"not an integer: ")+ee(u));if(!A)return new S(I);for(s=new S(g),y=l=new S(g),p=h=new S(g),O=X(A),c=s.e=O.length-I.e-1,s.c[0]=Oe[(m=c%N)<0?N+m:m],i=!i||u.comparedTo(s)>0?c>0?s:y:u,m=T,T=1/0,u=new S(O),h.c[0]=0;a=t(u,s,0,1),f=l.plus(a.times(p)),f.comparedTo(i)!=1;)l=p,p=f,y=h.plus(a.times(f=y)),h=f,s=u.minus(a.times(f=s)),u=f;return f=t(i.minus(l),p,0,1),h=h.plus(f.times(y)),l=l.plus(f.times(p)),h.s=y.s=I.s,c=c*2,E=t(y,p,c,x).minus(I).abs().comparedTo(t(h,l,c,x).minus(I).abs())<1?[y,p]:[h,l],T=m,E},n.toNumber=function(){return+ee(this)},n.toPrecision=function(i,s){return i!=null&&P(i,1,q),we(this,i,s,2)},n.toString=function(i){var s,l=this,p=l.s,f=l.e;return f===null?p?(s="Infinity",p<0&&(s="-"+s)):s="NaN":(i==null?s=f<=v||f>=w?ae(X(l.c),f):te(X(l.c),f,"0"):i===10&&de?(l=V(new S(l),d+f+1,x),s=te(X(l.c),l.e,"0")):(P(i,2,D.length,"Base"),s=e(te(X(l.c),f,"0"),10,i,p,!0)),p<0&&l.c[0]&&(s="-"+s)),s},n.valueOf=n.toJSON=function(){return ee(this)},n._isBigNumber=!0,n[Symbol.toStringTag]="BigNumber",n[Symbol.for("nodejs.util.inspect.custom")]=n.valueOf,r!=null&&S.set(r),S}function Y(r){var t=r|0;return r>0||r===t?t:t-1}function X(r){for(var t,e,o=1,n=r.length,g=r[0]+"";o<n;){for(t=r[o++]+"",e=N-t.length;e--;t="0"+t);g+=t}for(n=g.length;g.charCodeAt(--n)===48;);return g.slice(0,n+1||1)}function se(r,t){var e,o,n=r.c,g=t.c,d=r.s,x=t.s,v=r.e,w=t.e;if(!d||!x)return null;if(e=n&&!n[0],o=g&&!g[0],e||o)return e?o?0:-x:d;if(d!=x)return d;if(e=d<0,o=v==w,!n||!g)return o?0:!n^e?1:-1;if(!o)return v>w^e?1:-1;for(x=(v=n.length)<(w=g.length)?v:w,d=0;d<x;d++)if(n[d]!=g[d])return n[d]>g[d]^e?1:-1;return v==w?0:v>w^e?1:-1}function P(r,t,e,o){if(r<t||r>e||r!==H(r))throw Error(U+(o||"Argument")+(typeof r=="number"?r<t||r>e?" out of range: ":" not an integer: ":" not a primitive number: ")+String(r))}function ce(r){var t=r.c.length-1;return Y(r.e/N)==t&&r.c[t]%2!=0}function ae(r,t){return(r.length>1?r.charAt(0)+"."+r.slice(1):r)+(t<0?"e":"e+")+t}function te(r,t,e){var o,n;if(t<0){for(n=e+".";++t;n+=e);r=n+r}else if(o=r.length,++t>o){for(n=e,t-=o;--t;n+=e);r+=n}else t<o&&(r=r.slice(0,t)+"."+r.slice(t));return r}var Q=qe(),Ye=class{constructor(r){R(this,"key");R(this,"left",null);R(this,"right",null);this.key=r}},le=class extends Ye{constructor(r){super(r)}},Ze=class{constructor(){R(this,"size",0);R(this,"modificationCount",0);R(this,"splayCount",0)}splay(r){const t=this.root;if(t==null)return this.compare(r,r),-1;let e=null,o=null,n=null,g=null,d=t;const x=this.compare;let v;for(;;)if(v=x(d.key,r),v>0){let w=d.left;if(w==null||(v=x(w.key,r),v>0&&(d.left=w.right,w.right=d,d=w,w=d.left,w==null)))break;e==null?o=d:e.left=d,e=d,d=w}else if(v<0){let w=d.right;if(w==null||(v=x(w.key,r),v<0&&(d.right=w.left,w.left=d,d=w,w=d.right,w==null)))break;n==null?g=d:n.right=d,n=d,d=w}else break;return n!=null&&(n.right=d.left,d.left=g),e!=null&&(e.left=d.right,d.right=o),this.root!==d&&(this.root=d,this.splayCount++),v}splayMin(r){let t=r,e=t.left;for(;e!=null;){const o=e;t.left=o.right,o.right=t,t=o,e=t.left}return t}splayMax(r){let t=r,e=t.right;for(;e!=null;){const o=e;t.right=o.left,o.left=t,t=o,e=t.right}return t}_delete(r){if(this.root==null||this.splay(r)!=0)return null;let e=this.root;const o=e,n=e.left;if(this.size--,n==null)this.root=e.right;else{const g=e.right;e=this.splayMax(n),e.right=g,this.root=e}return this.modificationCount++,o}addNewRoot(r,t){this.size++,this.modificationCount++;const e=this.root;if(e==null){this.root=r;return}t<0?(r.left=e,r.right=e.right,e.right=null):(r.right=e,r.left=e.left,e.left=null),this.root=r}_first(){const r=this.root;return r==null?null:(this.root=this.splayMin(r),this.root)}_last(){const r=this.root;return r==null?null:(this.root=this.splayMax(r),this.root)}clear(){this.root=null,this.size=0,this.modificationCount++}has(r){return this.validKey(r)&&this.splay(r)==0}defaultCompare(){return(r,t)=>r<t?-1:r>t?1:0}wrap(){return{getRoot:()=>this.root,setRoot:r=>{this.root=r},getSize:()=>this.size,getModificationCount:()=>this.modificationCount,getSplayCount:()=>this.splayCount,setSplayCount:r=>{this.splayCount=r},splay:r=>this.splay(r),has:r=>this.has(r)}}},pt,re,ye=(re=class extends Ze{constructor(e,o){super();R(this,"root",null);R(this,"compare");R(this,"validKey");R(this,pt,"[object Set]");this.compare=e??this.defaultCompare(),this.validKey=o??(n=>n!=null&&n!=null)}delete(e){return this.validKey(e)?this._delete(e)!=null:!1}deleteAll(e){for(const o of e)this.delete(o)}forEach(e){const o=this[Symbol.iterator]();let n;for(;n=o.next(),!n.done;)e(n.value,n.value,this)}add(e){const o=this.splay(e);return o!=0&&this.addNewRoot(new le(e),o),this}addAndReturn(e){const o=this.splay(e);return o!=0&&this.addNewRoot(new le(e),o),this.root.key}addAll(e){for(const o of e)this.add(o)}isEmpty(){return this.root==null}isNotEmpty(){return this.root!=null}single(){if(this.size==0)throw"Bad state: No element";if(this.size>1)throw"Bad state: Too many element";return this.root.key}first(){if(this.size==0)throw"Bad state: No element";return this._first().key}last(){if(this.size==0)throw"Bad state: No element";return this._last().key}lastBefore(e){if(e==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(e)<0)return this.root.key;let n=this.root.left;if(n==null)return null;let g=n.right;for(;g!=null;)n=g,g=n.right;return n.key}firstAfter(e){if(e==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(e)>0)return this.root.key;let n=this.root.right;if(n==null)return null;let g=n.left;for(;g!=null;)n=g,g=n.left;return n.key}retainAll(e){const o=new re(this.compare,this.validKey),n=this.modificationCount;for(const g of e){if(n!=this.modificationCount)throw"Concurrent modification during iteration.";this.validKey(g)&&this.splay(g)==0&&o.add(this.root.key)}o.size!=this.size&&(this.root=o.root,this.size=o.size,this.modificationCount++)}lookup(e){return!this.validKey(e)||this.splay(e)!=0?null:this.root.key}intersection(e){const o=new re(this.compare,this.validKey);for(const n of this)e.has(n)&&o.add(n);return o}difference(e){const o=new re(this.compare,this.validKey);for(const n of this)e.has(n)||o.add(n);return o}union(e){const o=this.clone();return o.addAll(e),o}clone(){const e=new re(this.compare,this.validKey);return e.size=this.size,e.root=this.copyNode(this.root),e}copyNode(e){if(e==null)return null;function o(g,d){let x,v;do{if(x=g.left,v=g.right,x!=null){const w=new le(x.key);d.left=w,o(x,w)}if(v!=null){const w=new le(v.key);d.right=w,g=v,d=w}}while(v!=null)}const n=new le(e.key);return o(e,n),n}toSet(){return this.clone()}entries(){return new Je(this.wrap())}keys(){return this[Symbol.iterator]()}values(){return this[Symbol.iterator]()}[Symbol.iterator](){return new We(this.wrap())}},pt=Symbol.toStringTag,re),De=class{constructor(r){R(this,"tree");R(this,"path",new Array);R(this,"modificationCount",null);R(this,"splayCount");this.tree=r,this.splayCount=r.getSplayCount()}[Symbol.iterator](){return this}next(){return this.moveNext()?{done:!1,value:this.current()}:{done:!0,value:null}}current(){if(!this.path.length)return null;const r=this.path[this.path.length-1];return this.getValue(r)}rebuildPath(r){this.path.splice(0,this.path.length),this.tree.splay(r),this.path.push(this.tree.getRoot()),this.splayCount=this.tree.getSplayCount()}findLeftMostDescendent(r){for(;r!=null;)this.path.push(r),r=r.left}moveNext(){if(this.modificationCount!=this.tree.getModificationCount()){if(this.modificationCount==null){this.modificationCount=this.tree.getModificationCount();let e=this.tree.getRoot();for(;e!=null;)this.path.push(e),e=e.left;return this.path.length>0}throw"Concurrent modification during iteration."}if(!this.path.length)return!1;this.splayCount!=this.tree.getSplayCount()&&this.rebuildPath(this.path[this.path.length-1].key);let r=this.path[this.path.length-1],t=r.right;if(t!=null){for(;t!=null;)this.path.push(t),t=t.left;return!0}for(this.path.pop();this.path.length&&this.path[this.path.length-1].right===r;)r=this.path.pop();return this.path.length>0}},We=class extends De{getValue(r){return r.key}},Je=class extends De{getValue(r){return[r.key,r.key]}},Fe=r=>()=>r,Ie=r=>{const t=r?(e,o)=>o.minus(e).abs().isLessThanOrEqualTo(r):Fe(!1);return(e,o)=>t(e,o)?0:e.comparedTo(o)};function Qe(r){const t=r?(e,o,n,g,d)=>e.exponentiatedBy(2).isLessThanOrEqualTo(g.minus(o).exponentiatedBy(2).plus(d.minus(n).exponentiatedBy(2)).times(r)):Fe(!1);return(e,o,n)=>{const g=e.x,d=e.y,x=n.x,v=n.y,w=d.minus(v).times(o.x.minus(x)).minus(g.minus(x).times(o.y.minus(v)));return t(w,g,d,x,v)?0:w.comparedTo(0)}}var et=r=>r,tt=r=>{if(r){const t=new ye(Ie(r)),e=new ye(Ie(r)),o=(g,d)=>d.addAndReturn(g),n=g=>({x:o(g.x,t),y:o(g.y,e)});return n({x:new Q(0),y:new Q(0)}),n}return et},Le=r=>({set:t=>{ie=Le(t)},reset:()=>Le(r),compare:Ie(r),snap:tt(r),orient:Qe(r)}),ie=Le(),ue=(r,t)=>r.ll.x.isLessThanOrEqualTo(t.x)&&t.x.isLessThanOrEqualTo(r.ur.x)&&r.ll.y.isLessThanOrEqualTo(t.y)&&t.y.isLessThanOrEqualTo(r.ur.y),Ne=(r,t)=>{if(t.ur.x.isLessThan(r.ll.x)||r.ur.x.isLessThan(t.ll.x)||t.ur.y.isLessThan(r.ll.y)||r.ur.y.isLessThan(t.ll.y))return null;const e=r.ll.x.isLessThan(t.ll.x)?t.ll.x:r.ll.x,o=r.ur.x.isLessThan(t.ur.x)?r.ur.x:t.ur.x,n=r.ll.y.isLessThan(t.ll.y)?t.ll.y:r.ll.y,g=r.ur.y.isLessThan(t.ur.y)?r.ur.y:t.ur.y;return{ll:{x:e,y:n},ur:{x:o,y:g}}},pe=(r,t)=>r.x.times(t.y).minus(r.y.times(t.x)),ze=(r,t)=>r.x.times(t.x).plus(r.y.times(t.y)),xe=r=>ze(r,r).sqrt(),it=(r,t,e)=>{const o={x:t.x.minus(r.x),y:t.y.minus(r.y)},n={x:e.x.minus(r.x),y:e.y.minus(r.y)};return pe(n,o).div(xe(n)).div(xe(o))},nt=(r,t,e)=>{const o={x:t.x.minus(r.x),y:t.y.minus(r.y)},n={x:e.x.minus(r.x),y:e.y.minus(r.y)};return ze(n,o).div(xe(n)).div(xe(o))},Pe=(r,t,e)=>t.y.isZero()?null:{x:r.x.plus(t.x.div(t.y).times(e.minus(r.y))),y:e},Ce=(r,t,e)=>t.x.isZero()?null:{x:e,y:r.y.plus(t.y.div(t.x).times(e.minus(r.x)))},rt=(r,t,e,o)=>{if(t.x.isZero())return Ce(e,o,r.x);if(o.x.isZero())return Ce(r,t,e.x);if(t.y.isZero())return Pe(e,o,r.y);if(o.y.isZero())return Pe(r,t,e.y);const n=pe(t,o);if(n.isZero())return null;const g={x:e.x.minus(r.x),y:e.y.minus(r.y)},d=pe(g,t).div(n),x=pe(g,o).div(n),v=r.x.plus(x.times(t.x)),w=e.x.plus(d.times(o.x)),L=r.y.plus(x.times(t.y)),T=e.y.plus(d.times(o.y)),b=v.plus(w).div(2),C=L.plus(T).div(2);return{x:b,y:C}},J=class Ue{constructor(t,e){R(this,"point");R(this,"isLeft");R(this,"segment");R(this,"otherSE");R(this,"consumedBy");t.events===void 0?t.events=[this]:t.events.push(this),this.point=t,this.isLeft=e}static compare(t,e){const o=Ue.comparePoints(t.point,e.point);return o!==0?o:(t.point!==e.point&&t.link(e),t.isLeft!==e.isLeft?t.isLeft?1:-1:me.compare(t.segment,e.segment))}static comparePoints(t,e){return t.x.isLessThan(e.x)?-1:t.x.isGreaterThan(e.x)?1:t.y.isLessThan(e.y)?-1:t.y.isGreaterThan(e.y)?1:0}link(t){if(t.point===this.point)throw new Error("Tried to link already linked events");const e=t.point.events;for(let o=0,n=e.length;o<n;o++){const g=e[o];this.point.events.push(g),g.point=this.point}this.checkForConsuming()}checkForConsuming(){const t=this.point.events.length;for(let e=0;e<t;e++){const o=this.point.events[e];if(o.segment.consumedBy===void 0)for(let n=e+1;n<t;n++){const g=this.point.events[n];g.consumedBy===void 0&&o.otherSE.point.events===g.otherSE.point.events&&o.segment.consume(g.segment)}}}getAvailableLinkedEvents(){const t=[];for(let e=0,o=this.point.events.length;e<o;e++){const n=this.point.events[e];n!==this&&!n.segment.ringOut&&n.segment.isInResult()&&t.push(n)}return t}getLeftmostComparator(t){const e=new Map,o=n=>{const g=n.otherSE;e.set(n,{sine:it(this.point,t.point,g.point),cosine:nt(this.point,t.point,g.point)})};return(n,g)=>{e.has(n)||o(n),e.has(g)||o(g);const{sine:d,cosine:x}=e.get(n),{sine:v,cosine:w}=e.get(g);return d.isGreaterThanOrEqualTo(0)&&v.isGreaterThanOrEqualTo(0)?x.isLessThan(w)?1:x.isGreaterThan(w)?-1:0:d.isLessThan(0)&&v.isLessThan(0)?x.isLessThan(w)?-1:x.isGreaterThan(w)?1:0:v.isLessThan(d)?-1:v.isGreaterThan(d)?1:0}}},st=class be{constructor(t){R(this,"events");R(this,"poly");R(this,"_isExteriorRing");R(this,"_enclosingRing");this.events=t;for(let e=0,o=t.length;e<o;e++)t[e].segment.ringOut=this;this.poly=null}static factory(t){const e=[];for(let o=0,n=t.length;o<n;o++){const g=t[o];if(!g.isInResult()||g.ringOut)continue;let d=null,x=g.leftSE,v=g.rightSE;const w=[x],L=x.point,T=[];for(;d=x,x=v,w.push(x),x.point!==L;)for(;;){const b=x.getAvailableLinkedEvents();if(b.length===0){const j=w[0].point,D=w[w.length-1].point;throw new Error(`Unable to complete output ring starting at [${j.x}, ${j.y}]. Last matching segment found ends at [${D.x}, ${D.y}].`)}if(b.length===1){v=b[0].otherSE;break}let C=null;for(let j=0,D=T.length;j<D;j++)if(T[j].point===x.point){C=j;break}if(C!==null){const j=T.splice(C)[0],D=w.splice(j.index);D.unshift(D[0].otherSE),e.push(new be(D.reverse()));continue}T.push({index:w.length,point:x.point});const $=x.getLeftmostComparator(d);v=b.sort($)[0].otherSE;break}e.push(new be(w))}return e}getGeom(){let t=this.events[0].point;const e=[t];for(let w=1,L=this.events.length-1;w<L;w++){const T=this.events[w].point,b=this.events[w+1].point;ie.orient(T,t,b)!==0&&(e.push(T),t=T)}if(e.length===1)return null;const o=e[0],n=e[1];ie.orient(o,t,n)===0&&e.shift(),e.push(e[0]);const g=this.isExteriorRing()?1:-1,d=this.isExteriorRing()?0:e.length-1,x=this.isExteriorRing()?e.length:-1,v=[];for(let w=d;w!=x;w+=g)v.push([e[w].x.toNumber(),e[w].y.toNumber()]);return v}isExteriorRing(){if(this._isExteriorRing===void 0){const t=this.enclosingRing();this._isExteriorRing=t?!t.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let t=this.events[0];for(let n=1,g=this.events.length;n<g;n++){const d=this.events[n];J.compare(t,d)>0&&(t=d)}let e=t.segment.prevInResult(),o=e?e.prevInResult():null;for(;;){if(!e)return null;if(!o)return e.ringOut;if(o.ringOut!==e.ringOut)return o.ringOut?.enclosingRing()!==e.ringOut?e.ringOut:e.ringOut?.enclosingRing();e=o.prevInResult(),o=e?e.prevInResult():null}}},Be=class{constructor(r){R(this,"exteriorRing");R(this,"interiorRings");this.exteriorRing=r,r.poly=this,this.interiorRings=[]}addInterior(r){this.interiorRings.push(r),r.poly=this}getGeom(){const r=this.exteriorRing.getGeom();if(r===null)return null;const t=[r];for(let e=0,o=this.interiorRings.length;e<o;e++){const n=this.interiorRings[e].getGeom();n!==null&&t.push(n)}return t}},ot=class{constructor(r){R(this,"rings");R(this,"polys");this.rings=r,this.polys=this._composePolys(r)}getGeom(){const r=[];for(let t=0,e=this.polys.length;t<e;t++){const o=this.polys[t].getGeom();o!==null&&r.push(o)}return r}_composePolys(r){const t=[];for(let e=0,o=r.length;e<o;e++){const n=r[e];if(!n.poly)if(n.isExteriorRing())t.push(new Be(n));else{const g=n.enclosingRing();g?.poly||t.push(new Be(g)),g?.poly?.addInterior(n)}}return t}},lt=class{constructor(r,t=me.compare){R(this,"queue");R(this,"tree");R(this,"segments");this.queue=r,this.tree=new ye(t),this.segments=[]}process(r){const t=r.segment,e=[];if(r.consumedBy)return r.isLeft?this.queue.delete(r.otherSE):this.tree.delete(t),e;r.isLeft&&this.tree.add(t);let o=t,n=t;do o=this.tree.lastBefore(o);while(o!=null&&o.consumedBy!=null);do n=this.tree.firstAfter(n);while(n!=null&&n.consumedBy!=null);if(r.isLeft){let g=null;if(o){const x=o.getIntersection(t);if(x!==null&&(t.isAnEndpoint(x)||(g=x),!o.isAnEndpoint(x))){const v=this._splitSafely(o,x);for(let w=0,L=v.length;w<L;w++)e.push(v[w])}}let d=null;if(n){const x=n.getIntersection(t);if(x!==null&&(t.isAnEndpoint(x)||(d=x),!n.isAnEndpoint(x))){const v=this._splitSafely(n,x);for(let w=0,L=v.length;w<L;w++)e.push(v[w])}}if(g!==null||d!==null){let x=null;g===null?x=d:d===null?x=g:x=J.comparePoints(g,d)<=0?g:d,this.queue.delete(t.rightSE),e.push(t.rightSE);const v=t.split(x);for(let w=0,L=v.length;w<L;w++)e.push(v[w])}e.length>0?(this.tree.delete(t),e.push(r)):(this.segments.push(t),t.prev=o)}else{if(o&&n){const g=o.getIntersection(n);if(g!==null){if(!o.isAnEndpoint(g)){const d=this._splitSafely(o,g);for(let x=0,v=d.length;x<v;x++)e.push(d[x])}if(!n.isAnEndpoint(g)){const d=this._splitSafely(n,g);for(let x=0,v=d.length;x<v;x++)e.push(d[x])}}}this.tree.delete(t)}return e}_splitSafely(r,t){this.tree.delete(r);const e=r.rightSE;this.queue.delete(e);const o=r.split(t);return o.push(e),r.consumedBy===void 0&&this.tree.add(r),o}},ut=class{constructor(){R(this,"type");R(this,"numMultiPolys")}run(r,t,e){fe.type=r;const o=[new Ge(t,!0)];for(let w=0,L=e.length;w<L;w++)o.push(new Ge(e[w],!1));if(fe.numMultiPolys=o.length,fe.type==="difference"){const w=o[0];let L=1;for(;L<o.length;)Ne(o[L].bbox,w.bbox)!==null?L++:o.splice(L,1)}if(fe.type==="intersection")for(let w=0,L=o.length;w<L;w++){const T=o[w];for(let b=w+1,C=o.length;b<C;b++)if(Ne(T.bbox,o[b].bbox)===null)return[]}const n=new ye(J.compare);for(let w=0,L=o.length;w<L;w++){const T=o[w].getSweepEvents();for(let b=0,C=T.length;b<C;b++)n.add(T[b])}const g=new lt(n);let d=null;for(n.size!=0&&(d=n.first(),n.delete(d));d;){const w=g.process(d);for(let L=0,T=w.length;L<T;L++){const b=w[L];b.consumedBy===void 0&&n.add(b)}n.size!=0?(d=n.first(),n.delete(d)):d=null}ie.reset();const x=st.factory(g.segments);return new ot(x).getGeom()}},fe=new ut,_e=fe,ft=0,me=class ge{constructor(t,e,o,n){R(this,"id");R(this,"leftSE");R(this,"rightSE");R(this,"rings");R(this,"windings");R(this,"ringOut");R(this,"consumedBy");R(this,"prev");R(this,"_prevInResult");R(this,"_beforeState");R(this,"_afterState");R(this,"_isInResult");this.id=++ft,this.leftSE=t,t.segment=this,t.otherSE=e,this.rightSE=e,e.segment=this,e.otherSE=t,this.rings=o,this.windings=n}static compare(t,e){const o=t.leftSE.point.x,n=e.leftSE.point.x,g=t.rightSE.point.x,d=e.rightSE.point.x;if(d.isLessThan(o))return 1;if(g.isLessThan(n))return-1;const x=t.leftSE.point.y,v=e.leftSE.point.y,w=t.rightSE.point.y,L=e.rightSE.point.y;if(o.isLessThan(n)){if(v.isLessThan(x)&&v.isLessThan(w))return 1;if(v.isGreaterThan(x)&&v.isGreaterThan(w))return-1;const T=t.comparePoint(e.leftSE.point);if(T<0)return 1;if(T>0)return-1;const b=e.comparePoint(t.rightSE.point);return b!==0?b:-1}if(o.isGreaterThan(n)){if(x.isLessThan(v)&&x.isLessThan(L))return-1;if(x.isGreaterThan(v)&&x.isGreaterThan(L))return 1;const T=e.comparePoint(t.leftSE.point);if(T!==0)return T;const b=t.comparePoint(e.rightSE.point);return b<0?1:b>0?-1:1}if(x.isLessThan(v))return-1;if(x.isGreaterThan(v))return 1;if(g.isLessThan(d)){const T=e.comparePoint(t.rightSE.point);if(T!==0)return T}if(g.isGreaterThan(d)){const T=t.comparePoint(e.rightSE.point);if(T<0)return 1;if(T>0)return-1}if(!g.eq(d)){const T=w.minus(x),b=g.minus(o),C=L.minus(v),$=d.minus(n);if(T.isGreaterThan(b)&&C.isLessThan($))return 1;if(T.isLessThan(b)&&C.isGreaterThan($))return-1}return g.isGreaterThan(d)?1:g.isLessThan(d)||w.isLessThan(L)?-1:w.isGreaterThan(L)?1:t.id<e.id?-1:t.id>e.id?1:0}static fromRing(t,e,o){let n,g,d;const x=J.comparePoints(t,e);if(x<0)n=t,g=e,d=1;else if(x>0)n=e,g=t,d=-1;else throw new Error(`Tried to create degenerate segment at [${t.x}, ${t.y}]`);const v=new J(n,!0),w=new J(g,!1);return new ge(v,w,[o],[d])}replaceRightSE(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const t=this.leftSE.point.y,e=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t.isLessThan(e)?t:e},ur:{x:this.rightSE.point.x,y:t.isGreaterThan(e)?t:e}}}vector(){return{x:this.rightSE.point.x.minus(this.leftSE.point.x),y:this.rightSE.point.y.minus(this.leftSE.point.y)}}isAnEndpoint(t){return t.x.eq(this.leftSE.point.x)&&t.y.eq(this.leftSE.point.y)||t.x.eq(this.rightSE.point.x)&&t.y.eq(this.rightSE.point.y)}comparePoint(t){return ie.orient(this.leftSE.point,t,this.rightSE.point)}getIntersection(t){const e=this.bbox(),o=t.bbox(),n=Ne(e,o);if(n===null)return null;const g=this.leftSE.point,d=this.rightSE.point,x=t.leftSE.point,v=t.rightSE.point,w=ue(e,x)&&this.comparePoint(x)===0,L=ue(o,g)&&t.comparePoint(g)===0,T=ue(e,v)&&this.comparePoint(v)===0,b=ue(o,d)&&t.comparePoint(d)===0;if(L&&w)return b&&!T?d:!b&&T?v:null;if(L)return T&&g.x.eq(v.x)&&g.y.eq(v.y)?null:g;if(w)return b&&d.x.eq(x.x)&&d.y.eq(x.y)?null:x;if(b&&T)return null;if(b)return d;if(T)return v;const C=rt(g,this.vector(),x,t.vector());return C===null||!ue(n,C)?null:ie.snap(C)}split(t){const e=[],o=t.events!==void 0,n=new J(t,!0),g=new J(t,!1),d=this.rightSE;this.replaceRightSE(g),e.push(g),e.push(n);const x=new ge(n,d,this.rings.slice(),this.windings.slice());return J.comparePoints(x.leftSE.point,x.rightSE.point)>0&&x.swapEvents(),J.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),o&&(n.checkForConsuming(),g.checkForConsuming()),e}swapEvents(){const t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let e=0,o=this.windings.length;e<o;e++)this.windings[e]*=-1}consume(t){let e=this,o=t;for(;e.consumedBy;)e=e.consumedBy;for(;o.consumedBy;)o=o.consumedBy;const n=ge.compare(e,o);if(n!==0){if(n>0){const g=e;e=o,o=g}if(e.prev===o){const g=e;e=o,o=g}for(let g=0,d=o.rings.length;g<d;g++){const x=o.rings[g],v=o.windings[g],w=e.rings.indexOf(x);w===-1?(e.rings.push(x),e.windings.push(v)):e.windings[w]+=v}o.rings=null,o.windings=null,o.consumedBy=e,o.leftSE.consumedBy=e.leftSE,o.rightSE.consumedBy=e.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};const e=this._afterState.rings,o=this._afterState.windings,n=this._afterState.multiPolys;for(let x=0,v=this.rings.length;x<v;x++){const w=this.rings[x],L=this.windings[x],T=e.indexOf(w);T===-1?(e.push(w),o.push(L)):o[T]+=L}const g=[],d=[];for(let x=0,v=e.length;x<v;x++){if(o[x]===0)continue;const w=e[x],L=w.poly;if(d.indexOf(L)===-1)if(w.isExterior)g.push(L);else{d.indexOf(L)===-1&&d.push(L);const T=g.indexOf(w.poly);T!==-1&&g.splice(T,1)}}for(let x=0,v=g.length;x<v;x++){const w=g[x].multiPoly;n.indexOf(w)===-1&&n.push(w)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const t=this.beforeState().multiPolys,e=this.afterState().multiPolys;switch(_e.type){case"union":{const o=t.length===0,n=e.length===0;this._isInResult=o!==n;break}case"intersection":{let o,n;t.length<e.length?(o=t.length,n=e.length):(o=e.length,n=t.length),this._isInResult=n===_e.numMultiPolys&&o<n;break}case"xor":{const o=Math.abs(t.length-e.length);this._isInResult=o%2===1;break}case"difference":{const o=n=>n.length===1&&n[0].isSubject;this._isInResult=o(t)!==o(e);break}}return this._isInResult}},ke=class{constructor(r,t,e){R(this,"poly");R(this,"isExterior");R(this,"segments");R(this,"bbox");if(!Array.isArray(r)||r.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=t,this.isExterior=e,this.segments=[],typeof r[0][0]!="number"||typeof r[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const o=ie.snap({x:new Q(r[0][0]),y:new Q(r[0][1])});this.bbox={ll:{x:o.x,y:o.y},ur:{x:o.x,y:o.y}};let n=o;for(let g=1,d=r.length;g<d;g++){if(typeof r[g][0]!="number"||typeof r[g][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const x=ie.snap({x:new Q(r[g][0]),y:new Q(r[g][1])});x.x.eq(n.x)&&x.y.eq(n.y)||(this.segments.push(me.fromRing(n,x,this)),x.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=x.x),x.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=x.y),x.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=x.x),x.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=x.y),n=x)}(!o.x.eq(n.x)||!o.y.eq(n.y))&&this.segments.push(me.fromRing(n,o,this))}getSweepEvents(){const r=[];for(let t=0,e=this.segments.length;t<e;t++){const o=this.segments[t];r.push(o.leftSE),r.push(o.rightSE)}return r}},ht=class{constructor(r,t){R(this,"multiPoly");R(this,"exteriorRing");R(this,"interiorRings");R(this,"bbox");if(!Array.isArray(r))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new ke(r[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let e=1,o=r.length;e<o;e++){const n=new ke(r[e],this,!1);n.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=n.bbox.ll.x),n.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=n.bbox.ll.y),n.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=n.bbox.ur.x),n.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=n.bbox.ur.y),this.interiorRings.push(n)}this.multiPoly=t}getSweepEvents(){const r=this.exteriorRing.getSweepEvents();for(let t=0,e=this.interiorRings.length;t<e;t++){const o=this.interiorRings[t].getSweepEvents();for(let n=0,g=o.length;n<g;n++)r.push(o[n])}return r}},Ge=class{constructor(r,t){R(this,"isSubject");R(this,"polys");R(this,"bbox");if(!Array.isArray(r))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof r[0][0][0]=="number"&&(r=[r])}catch{}this.polys=[],this.bbox={ll:{x:new Q(Number.POSITIVE_INFINITY),y:new Q(Number.POSITIVE_INFINITY)},ur:{x:new Q(Number.NEGATIVE_INFINITY),y:new Q(Number.NEGATIVE_INFINITY)}};for(let e=0,o=r.length;e<o;e++){const n=new ht(r[e],this);n.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=n.bbox.ll.x),n.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=n.bbox.ll.y),n.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=n.bbox.ur.x),n.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=n.bbox.ur.y),this.polys.push(n)}this.isSubject=t}getSweepEvents(){const r=[];for(let t=0,e=this.polys.length;t<e;t++){const o=this.polys[t].getSweepEvents();for(let n=0,g=o.length;n<g;n++)r.push(o[n])}return r}},ct=(r,...t)=>_e.run("union",r,t);ie.set;function at(r,t={}){const e=[];if(Xe(r,n=>{e.push(n.coordinates)}),e.length<2)throw new Error("Must have at least 2 geometries");const o=ct(e[0],...e.slice(1));return o.length===0?null:o.length===1?Ve(o[0],t.properties):Ke(o,t.properties)}var mt=at;export{mt as default,at as union};
